import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:flutter_screenutil/flutter_screenutil.dart';
import 'package:hive_flutter/hive_flutter.dart';
import 'package:vista/Provider/appwriteProvider.dart';

import '../../Provider/themeProvider.dart';
import 'themes.dart';

Widget CustomButtonWelcomePage(
    Color backgrundColor, String text, Color colorText, dynamic click) {
  return GestureDetector(
    onTap: click,
    child: Container(
      width: 180,
      height: 65,
      decoration: BoxDecoration(
          borderRadius: BorderRadius.circular(25), color: backgrundColor),
      child: Center(
        child: Text(
          text,
          style: TextStyle(
              color: colorText, fontSize: 20, fontWeight: FontWeight.bold),
        ),
      ),
    ),
  );
}

customTextField(String hintText, TextEditingController controller,
    dynamic validator, bool obscureText, TextInputType keyboardType,
    {required int maxLines}) {
  return Directionality(
    textDirection: TextDirection.rtl,
    child: Padding(
      padding: const EdgeInsets.symmetric(horizontal: 20),
      child: TextFormField(
        controller: controller,
        validator: validator,
        obscureText: obscureText,
        keyboardType: keyboardType,
        decoration: InputDecoration(
          hintText: hintText,
          enabledBorder: OutlineInputBorder(
            borderSide: const BorderSide(
              width: .7,
            ),
            borderRadius: BorderRadius.circular(18),
          ),
          focusedBorder: OutlineInputBorder(
            borderSide: const BorderSide(
              width: 1.5,
            ),
            borderRadius: BorderRadius.circular(18),
          ),
        ),
      ),
    ),
  );
}

class topText extends StatelessWidget {
  topText({
    super.key,
    required this.text,
  });

  String text;

  @override
  Widget build(BuildContext context) {
    return Align(
      alignment: Alignment.centerRight,
      child: Padding(
        padding: const EdgeInsets.only(right: 15),
        child: Text(
          text,
          style: const TextStyle(fontSize: 35, fontWeight: FontWeight.bold),
        ),
      ),
    );
  }
}

extension ContextExtension on BuildContext {
  void showSnackBar(String message, {bool isError = false}) {
    ScaffoldMessenger.of(this).showSnackBar(
      SnackBar(
        content: Text(textDirection: TextDirection.rtl, message),
        backgroundColor: isError
            ? Theme.of(this).colorScheme.error
            : Theme.of(this).snackBarTheme.backgroundColor,
      ),
    );
  }
}

Widget customButton(dynamic ontap, String text, final WidgetRef ref) {
  // final currentTheme = ref.watch(themeProvider); // Ø¯Ø±ÛŒØ§ÙØª ØªÙ… Ø¬Ø§Ø±ÛŒ

  return GestureDetector(
    onTap: ontap,
    child: Container(
      width: 350,
      height: 50,
      decoration: BoxDecoration(
          // color: currentTheme.brightness == Brightness.dark
          //     ? Colors.white
          //     : Colors.grey[800],
          borderRadius: BorderRadius.circular(15)),
      child: Align(
        alignment: Alignment.center,
        child: Text(
          textAlign: TextAlign.center,
          text,
          style: TextStyle(
            fontSize: 20,
            // color: currentTheme.brightness == Brightness.dark
            //     ? Colors.black
            //     : Colors.white,
          ),
        ),
      ),
    ),
  );
}

//CustomDrawer

Future<Drawer> CustomDrawer(AsyncValue<Map<String, dynamic>?> getprofile,
    ThemeData currentcolor, BuildContext context, WidgetRef ref) async {
  final user = ref.read(accountProvider);
  final userget = await user.get();

  void saveThemeToHive(String theme) async {
    var box = Hive.box('settings');
    await box.put('selectedTheme', theme);

    final themeNotifier = ref.watch(themeProvider.notifier);
  }

  return Drawer(
    width: 0.6.sw,
    child: Column(
      children: <Widget>[
        DrawerHeader(
          padding: EdgeInsets.zero,
          margin: EdgeInsets.zero,
          child: getprofile.when(
              data: (getprofile) {
                return UserAccountsDrawerHeader(
                  decoration: BoxDecoration(
                      color: currentcolor.appBarTheme.backgroundColor),
                  currentAccountPicture: CircleAvatar(
                    radius: 30,
                    backgroundImage: getprofile!['avatar_url'] != null
                        ? NetworkImage(getprofile['avatar_url'].toString())
                        : const AssetImage(
                            'lib/util/images/default-avatar.jpg'),
                  ),
                  margin: const EdgeInsets.only(bottom: 0),
                  currentAccountPictureSize: const Size(65, 65),
                  accountName: Row(
                    children: [
                      Text(
                        '${getprofile['username']}',
                        style: TextStyle(
                            color: currentcolor.brightness == Brightness.dark
                                ? Colors.white
                                : Colors.black),
                      ),
                      const SizedBox(
                        width: 5,
                      ),
                      if (getprofile['is_verified'])
                        const Icon(Icons.verified,
                            color: Colors.blue, size: 16),
                    ],
                  ),
                  accountEmail: Text(userget.email,
                      style: TextStyle(
                          color: currentcolor.brightness == Brightness.dark
                              ? Colors.white
                              : Colors.black)),
                );
              },
              error: (error, stack) {
                final errorMsg = error.toString() == 'User is not logged in'
                    ? 'Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ø³ÛŒØ³ØªÙ… Ù†Ø´Ø¯Ù‡ Ø§Ø³ØªØŒ Ù„Ø·ÙØ§Ù‹ ÙˆØ±ÙˆØ¯ Ú©Ù†ÛŒØ¯.'
                    : 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±ØŒ Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.';

                return Center(child: Text(errorMsg));
              },
              loading: () => const Center(child: CircularProgressIndicator())),
        ),
        SwitchListTile(
          title: const Text('Ø­Ø§Ù„Øª Ø´Ø¨/Ø±ÙˆØ²'),
          value: ref.watch(themeProvider).brightness == Brightness.dark,
          onChanged: (bool isDark) {
            // ØªØºÛŒÛŒØ± ØªÙ…
            final themeNotifier = ref.read(themeProvider.notifier);

            if (isDark) {
              themeNotifier.state = darkTheme;
              saveThemeToHive('dark');
            } else {
              themeNotifier.state = lightTheme;
              saveThemeToHive('light');
            }
          },
          secondary: Icon(
            ref.watch(themeProvider).brightness == Brightness.dark
                ? Icons.dark_mode
                : Icons.light_mode,
          ),
          activeColor: Colors.black,
          activeTrackColor: Colors.white10,
        ),

        ListTile(
          leading: const Icon(Icons.settings),
          title: const Text(
            'ØªÙ†Ø¸ÛŒÙ…Ø§Øª',
          ),
          onTap: () {
            Navigator.pushNamed(context, '/settings');
          },
        ),
        ListTile(
          leading: const Icon(Icons.support_agent),
          title: const Text(
            'Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ',
          ),
          // onTap: () {
          //   Navigator.push(context,
          //       MaterialPageRoute(builder: (context) => const SupportPage()));
          // },
        ),
        // ListTile(
        //   leading: const Icon(Icons.person_add),
        //   title: const Text(
        //     'Ø¯Ø¹ÙˆØª Ø§Ø² Ø¯ÙˆØ³ØªØ§Ù†',
        //   ),
        //   onTap: () {
        //     const String inviteText =
        //         'Ø¯ÙˆØ³Øª Ø¹Ø²ÛŒØ² Ø³Ù„Ø§Ù…! Ù…Ù† Ø§Ø² ÙˆÛŒØ³ØªØ§ Ù†ÙˆØª Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù‡Ø§Ù… Ùˆ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ú©Ù„ÛŒ Ø±ÙÛŒÙ‚ Ø¬Ø¯ÛŒØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒÚ©Ù†Ù…! \n Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒÚ©Ù†Ù… Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù† Ø§Ø² Ø¨Ø§Ø²Ø§Ø± Ù†ØµØ¨Ø´ Ú©Ù†ÛŒğŸ˜‰:  https://cafebazaar.ir/app/com.example.vista_notes2/ ';
        //     Share.share(inviteText);
        //   },
        // ),
        ListTile(
          leading: const Icon(Icons.logout),
          title: const Text(
            'Ø®Ø±ÙˆØ¬',
          ),
          onTap: () {
            // final user = ref.read(accountProvider);
            user.deleteSessions();
            Navigator.pushReplacementNamed(context, '/welcome');
          },
        ),
      ],
    ),
  );
}
